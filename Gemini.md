
# Aegis项目核心设计纲领 (最终版)

## 初始核心理念 (v1.0)

项目最初旨在开发一个由AI驱动的“网站被动扫描器”，其核心特性是：
1.  **被动的上下文感知分析**：AI通过理解前端代码、交互逻辑和业务流程来进行分析，而不是依赖传统的Payload注入。
2.  **安全的动态主动分析**：AI可以像测试人员一样与前端进行交互，但受到严格的安全限制。

---

## 最终架构演进：混合智能自主代理 (vFinal)

经过多轮迭代和重构，Aegis已从一个被动扫描器，进化为一个**方法论驱动的、具备多重能力的自主安全代理**。其最终形态融合了以下核心设计思想：

### 1. “影子调查员” (无感的主动代理)

这是Aegis的核心工作模式。它将用户体验与AI的主动测试完全解耦。

- **用户端**: 用户在自己的主浏览器中进行正常、无干扰的网页浏览。
- **Aegis端**: 后台的“侦察兵”(`CDPController`)只监控用户的顶层页面导航。每当用户访问一个新页面，Aegis的“调查任务管理器”(`InvestigationManager`)就会启动一个或多个独立的、并行的“AI调查员”(`AgentWorker`)。
- **影子浏览器**: 每一个AI调查员都在自己专属的、隐藏的“影子浏览器”中工作。它在这个沙箱环境中，自主地执行导航、点击、输入等所有主动测试操作。这使得AI的复杂、主动的测试行为，对用户完全透明无感。

### 2. “AI指挥官 + Python脚本尖兵” (混合智能)

Aegis不单纯依赖LLM的通用能力，而是采用更高效、更可靠的混合智能模型。

- **脚本尖兵 (`sast_tools`)**: 一系列轻量、高速、精准的Python脚本，负责执行模式化的静态分析任务（SAST），例如用正则表达式扫描硬编码的密钥、查找已知的危险函数（XSS Sinks）等。它们为AI提供第一轮的、可靠的攻击面线索。
- **IAST探针 (`js_hooks.js`)**: 通过在影子浏览器中注入JS Hook，我们建立了一个运行时探针（IAST）。它可以在应用的JS代码执行危险操作（如调用`innerHTML`）的瞬间，捕获到真实的、动态的数据，并将这些“铁证”实时报告给AI。
- **AI指挥官 (LLM)**: AI的核心职责被提升到战略层面。它接收来自SAST和IAST的“士兵”和“探针”的报告，结合自身的动态观察，进行高级的逻辑推理和风险研判，然后决策出下一步应该执行哪个交互动作（DAST），以验证或利用这些线索。

### 3. “测试计划驱动”的方法论

AI代理的行为不再是随机探索，而是遵循一个严谨的、类似人类专家的测试方法论。

1.  **侦察 (Reconnaissance)**: 任务开始时，代理首先对目标进行全面的信息收集（获取代码、SAST扫描等）。
2.  **规划 (Planning)**: 基于侦察情报，代理调用LLM扮演“测试负责人”，生成一份结构化的、包含多个具体测试用例的JSON格式的**测试计划**。
3.  **执行与分析 (Execution & Analysis)**: 代理的角色转变为“测试执行者”，逐一执行计划中的测试用例，并对每一个用例的结果，再次调用LLM进行小范围、高聚焦的**即时分析**，判断是否发现漏洞。

### 4. “双记忆系统” (可持续学习)

为了解决上下文窗口限制和知识复用的问题，代理拥有两套记忆系统。

- **长期记忆 (Long-Term Memory)**: 基于ChromaDB。在每次调查结束后，AI会对本次的目标进行一次“复盘”，生成描述其技术栈和特点的**“架构指纹”**。这个指纹将与本次发现的漏洞，作为一条完整的“经验”存入向量数据库。在开始新任务时，AI会先用新目标的指纹，来检索过往的相似经验，作为决策参考。
- **工作记忆 (Working Memory)**: 在执行多步测试计划时，为了避免历史记录无限增长撑爆上下文，AI会在每一步之后进行一次“自我总结”，将当前的进展浓缩成一个简短的**“状态摘要”**。在做下一步决策时，它只需要参考这个最新的摘要，而无需回顾所有历史细节。
